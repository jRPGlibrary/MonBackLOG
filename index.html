<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comment Box</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .comment-box { margin-bottom: 20px; }
        .comment-box textarea { width: 100%; height: 100px; margin-bottom: 10px; }
        .comment { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <h1>Comments</h1>
    <div class="comment-box">
        <textarea id="commentText" placeholder="Add a comment..."></textarea>
        <button onclick="submitComment()">Submit</button>
    </div>
    <div id="comments"></div>

    <!-- Import Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>

    <script>
        console.log("Starting script...");

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAFsnabnd0A0LeEwO3w9gK-6fhc_rWSnNU",
            authDomain: "jrpglibrary-38e6c.firebaseapp.com",
            projectId: "jrpglibrary-38e6c",
            storageBucket: "jrpglibrary-38e6c.appspot.com",
            messagingSenderId: "82820484706",
            appId: "1:82820484706:web:b1130a49ee3f47c0198b3b",
            measurementId: "G-98KKZX26D8"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);

        // Initialize Firestore
        const db = firebase.firestore();

        console.log("Firebase initialized...");

        async function submitComment() {
            console.log("Submit button clicked...");
            const commentText = document.getElementById('commentText').value;
            console.log("Comment text: ", commentText);
            const pageId = window.location.pathname; // Unique identifier for each Notion page
            console.log("Page ID: ", pageId);
            if (commentText.trim()) {
                try {
                    await db.collection('comments').add({
                        text: commentText,
                        pageId: pageId,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    console.log('Comment added successfully');
                    document.getElementById('commentText').value = '';
                    loadComments();
                } catch (error) {
                    console.error('Error adding comment: ', error);
                }
            } else {
                console.warn('Comment text is empty');
            }
        }

        async function loadComments() {
            console.log("Loading comments...");
            const pageId = window.location.pathname;
            const commentsDiv = document.getElementById('comments');
            commentsDiv.innerHTML = '';
            try {
                const querySnapshot = await db.collection('comments')
                    .where('pageId', '==', pageId)
                    .orderBy('timestamp', 'desc')
                    .get();
                querySnapshot.forEach((doc) => {
                    const commentData = doc.data();
                    const commentDiv = document.createElement('div');
                    commentDiv.classList.add('comment');
                    commentDiv.innerText = commentData.text;
                    commentsDiv.appendChild(commentDiv);
                });
                console.log('Comments loaded successfully');
            } catch (error) {
                console.error('Error loading comments: ', error);
            }
        }

        loadComments();
    </script>
</body>
</html>

